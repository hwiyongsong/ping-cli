<ion-header clear>
  <ion-navbar></ion-navbar>
</ion-header>

<ion-content #content>
	<ion-section class="cover-message-section" *ngIf="thread.coverMessage">
		<ion-section-header no-top-padding>
			<ion-item (click)="onViewAccountProfile(thread.coverMessage.from)">
				<h4>{{thread.from.getFullName()}}<sub class="no-wrap">{{thread.from.headline}}</sub></h4>
				<ion-avatar item-end *ngIf="thread.from.profileImage">
		      <img src="{{thread.from.profileImage.url}}">
		      <ion-badge small *ngIf="thread.from.relationship">{{thread.from.relationship.graphDistance}}</ion-badge>
		    </ion-avatar>
			</ion-item>
		</ion-section-header>
		<ion-section-content>
			<p tiny-bottom-margin class="meta">{{thread.createdAt}} â€¢ {{thread.category}}</p>
			<article>
				<h4>{{thread.subject}}</h4>
				<p top-margin class="message-body" [innerHTML]="thread.coverMessage.body" *ngIf="thread.coverMessage.body"></p>
				<figure large-top-margin *ngIf="thread.coverMessage.video">
					<iframe allowfullscreen [src]="thread.coverMessage.video.url | safeurl" frameborder="0" class="video-embed"></iframe>		
				</figure>
				<p large-top-margin [innerHTML]="thread.coverMessage.video.caption" *ngIf="thread.coverMessage.video && thread.coverMessage.video.caption"></p>					
			</article>
		</ion-section-content>
	</ion-section>

  <ion-section class="messages-section">
  	<ion-section-content>
  		<div class="chat-thread">
  			<div class="chat-message" [class.left]="message.from.urn != accountProvider.currentAccount.urn" [class.right]="message.from.urn == accountProvider.currentAccount.urn" *ngFor="let message of thread.messages">
  				<ion-avatar (click)="onViewAccountProfile(message.from)">
			      <img [src]="message.from.profileImage.url">
			    </ion-avatar>
  				<div class="chat-bubble">
			  		<div class="message-body">{{message.body}}</div>  				
  					<div class="message-meta">{{message.createdAt}}</div>
  				</div>
  			</div>
  		</div>
  	</ion-section-content>
  </ion-section>
</ion-content>

<ion-footer padding [keyboard-attach]="content">
  <div *ngIf="!replyable">
		<button ion-button block (click)="onReplyable()" *ngIf="thread.category != 'Video'">Reply for {{bountyProvider.formatBounty(thread.bounty)}}</button>
		<button ion-button block (click)="onViewVideo()" *ngIf="thread.category == 'Video'">View Video for {{bountyProvider.formatBounty(thread.bounty)}}</button>  
  </div>
	<div flex *ngIf="replyable">
	  <ion-textarea autosize [(ngModel)]="reply" placeholder="Write a message..."></ion-textarea>
    <button ion-button auto-height (click)="onReply()">Reply</button>	
	</div>
</ion-footer>